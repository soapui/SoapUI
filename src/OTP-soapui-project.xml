<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project activeEnvironment="Default" name="OTP" resourceRoot="" soapui-version="4.5.2" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" wadlVersion="http://wadl.dev.java.net/2009/02" name="/otp/from_url" type="rest" basePath="" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://${#Project#Host}:${#Project#Port} </con:endpoint></con:endpoints><con:resource name="/vms/rest/otp" path="/vms/rest/otp/from_url/{otp}"><con:settings/><con:parameters><con:parameter><con:name>otp</con:name><con:style>TEMPLATE</con:style><con:default/></con:parameter></con:parameters><con:method name="Post otp_from_url" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/xml</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>text/html</con:mediaType><con:status>403</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json;charset=UTF-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="http://zvss1/vms/rest/otp/from_url/462242">ns:Response</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType>text/plain;charset=UTF-8</con:mediaType><con:status>502</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" mediaType="application/xml" postQueryString="false"><con:settings/><con:endpoint>http://${</con:endpoint><con:request/><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" wadlVersion="http://wadl.dev.java.net/2009/02" name="/otp/from_url/from_sms" type="rest" basePath="" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://${#Project#Host}:${#Project#Port} </con:endpoint></con:endpoints><con:resource name="/vms/rest//otp/from_url/urlotp/from_sms/smsotp" path="/vms/rest/otp/from_url/{urlotp}/from_sms/{smsotp}"><con:settings/><con:parameters><con:parameter><con:name>urlotp</con:name><con:value>${#Project#UrlOtp} </con:value><con:style>TEMPLATE</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default>${#Project#UrlOtp} </con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>smsotp</con:name><con:value>smsotp</con:value><con:style>TEMPLATE</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default>smsotp</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="PUT /otp/from_url/from_sms" method="PUT"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>404</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/xml</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>403</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>403</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType>text/plain;charset=UTF-8</con:mediaType><con:status>500 502</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json;charset=UTF-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="http://zvss1/vms/rest/otp/from_url/1887087527519017/from_sms/329720">ns:Response</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>403</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" mediaType="application/xml" postQueryString="false"><con:settings/><con:endpoint>http://${</con:endpoint><con:request/><con:credentials><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="smsotp" value="${#Project#SmsOtp} " xmlns="http://eviware.com/soapui/config"/></con:parameters></con:request></con:method></con:resource></con:interface><con:testSuite name="Init"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Init" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Groovy Script"><con:settings/><con:config><script>import groovy.sql.*
import com.eviware.soapui.impl.wsdl.WsdlInterface
import com.eviware.soapui.SoapUI.*
import com.eviware.soapui.support.GroovyUtils
import com.eviware.soapui.model.*
import com.eviware.soapui.support.scripting.*
import com.eviware.soapui.model.project.*

// MVTC
//def sql = groovy.sql.Sql.newInstance("jdbc:oracle:thin:@//ts2msvsvdb-scan:1521:DP8A", "vms_core_o", "vms", 'oracle.jdbc.driver.OracleDriver')
// 3S
def ProjectName = testRunner.testCase.testSuite.project.name
def Admin = 3
def userRole = '${Admin}'
def sql = groovy.sql.Sql.newInstance("jdbc:oracle:thin:@zvss1:1521:DP9A", "vms_core_o", "vms", 'oracle.jdbc.driver.OracleDriver')
def testCase = testRunner.testCase
def testSuite = testRunner.testCase.testSuite
def testproject = testRunner.testCase.testSuite.project
def VmsuserId_user = sql.firstRow("select vmsuserid from (select vmsuserid from customer cu, corporate co where cu.corporate_id=co.corporate_id ORDER BY dbms_random.value) where rownum &lt;= 1")
def CorporateId = sql.firstRow("select corporate_id from customer c where c.vmsuserid=${VmsuserId_user.vmsuserid}")
def CustomerId = sql.firstRow("select customer_id from customer c where c.vmsuserid=${VmsuserId_user.vmsuserid}")
def Msisdn = sql.firstRow("select msisdn from subscriber s where s.customer_id=${CustomerId.customer_id}")
def CorporateName = sql.firstRow("select name from corporate c where c.corporate_id=${CorporateId.Corporate_id}")
def VmsuserId_admin = sql.firstRow ("select c.vmsuserid from customer c, userrole_customer uc where c.customer_id=uc.customer_id and uc.userrole_id=3 and c.corporate_id=${CorporateId.corporate_id} and ROWNUM&lt;=1")

testproject.setPropertyValue("VmsuserId","${VmsuserId_admin.vmsuserid}");
testproject.setPropertyValue("VmsuserId_user","${VmsuserId_user.vmsuserid}");
testproject.setPropertyValue("CustomerId","${CustomerId.customer_id}");
testproject.setPropertyValue("Msisdn","${Msisdn.msisdn}");
testproject.setPropertyValue("CorporateId","${CorporateId.corporate_id}");
testproject.setPropertyValue("CorporateName","${CorporateName.name}");

// Log output
log.info "############### ProjectName=${ProjectName} ##################"
//log.info VmsuserId
log.info VmsuserId_user
log.info CustomerId
log.info Msisdn
log.info CorporateId
log.info CorporateName
log.info VmsuserId_admin</script></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:testSuite name="/otp/from_url  TestSuite"><con:description>TestSuite generated for REST Service [OTP]</con:description><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="/vms/rest/otp/from_url TestCase" searchProperties="true"><con:description>TestCase generated for REST Resource [/vms/rest/otp] located at [/vms/rest/otp/from_url/{otp}]</con:description><con:settings/><con:testStep type="restrequest" name="POST otp_from_url"><con:settings/><con:config service="/otp/from_url" resourcePath="/vms/rest/otp/from_url/{otp}" methodName="Post otp_from_url" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST otp_from_url" mediaType="application/xml" postQueryString="false" accept=""><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="HTTP_VMS_USER_ID" value="${#Project#VMSUserId}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://${#Project#Host}:${#Project#Port} </con:endpoint><con:request/><con:assertion type="Simple Contains" name="Contains"><con:configuration><token>otp</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:username>${#Project#Username}</con:username><con:password>${#Project#Password}</con:password><con:domain>${#Project#Domain}</con:domain><con:authType>Preemptive</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="otp" value="2193984350438587" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:testSuite name="/otp/from_url/from_sms TestSuite"><con:description>TestSuite generated for REST Service [/otp/from_url/from_sms]</con:description><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="/vms/rest//otp/from_url/urlotp/from_sms/smsotp TestCase" searchProperties="true"><con:description>TestCase generated for REST Resource [/vms/rest//otp/from_url/urlotp/from_sms/smsotp] located at [/vms/rest/otp/from_url/{urlotp}/from_sms/{smsotp}]</con:description><con:settings/><con:testStep type="restrequest" name="Request 1"><con:settings/><con:config service="/otp/from_url/from_sms" resourcePath="/vms/rest/otp/from_url/{urlotp}/from_sms/{smsotp}" methodName="PUT /otp/from_url/from_sms" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Request 1" mediaType="application/xml" postQueryString="false" accept=""><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="VMSUserId" value="${#Project#VMSUserId}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://${#Project#Host}:${#Project#Port} </con:endpoint><con:request/><con:assertion type="XPath Match" name="Check for existance of [urlotp]"><con:configuration><path>declare namespace ns1='http://zvss1/vms/rest/otp/from_url/1887087527519017/from_sms/329720';
exists( //ns1:Response/ns1:requestParameters/ns1:urlotp)</path><content>true</content><allowWildcards>true</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:username>${#Project#Username}</con:username><con:password>${#Project#Password} </con:password><con:domain>${#Project#Domain} </con:domain><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="smsotp" value="329720"/>
  <con:entry key="urlotp" value="1887087527519017"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:requirements/><con:properties><con:property><con:name>Host</con:name><con:value>zvss2</con:value></con:property><con:property><con:name>Port</con:name><con:value>8080</con:value></con:property><con:property><con:name>MinPINLen</con:name><con:value>4</con:value></con:property><con:property><con:name>MinPUKLen</con:name><con:value>8</con:value></con:property><con:property><con:name>PINRetryCnt</con:name><con:value>3</con:value></con:property><con:property><con:name>PUKRetryCnt</con:name><con:value>3</con:value></con:property><con:property><con:name>OTPDefaultLen</con:name><con:value>6</con:value></con:property><con:property><con:name>Bans</con:name><con:value>12345678</con:value></con:property><con:property><con:name>Search</con:name><con:value>Corp </con:value></con:property><con:property><con:name>Start</con:name><con:value>0</con:value></con:property><con:property><con:name>Limit</con:name><con:value>100</con:value></con:property><con:property><con:name>Sort</con:name><con:value>date</con:value></con:property><con:property><con:name>Direction</con:name><con:value>ASC</con:value></con:property><con:property><con:name>Username</con:name><con:value>vmsmu</con:value></con:property><con:property><con:name>Password</con:name><con:value>secunet2012</con:value></con:property><con:property><con:name>Domain</con:name><con:value>VMSCore</con:value></con:property><con:property><con:name>Type</con:name><con:value>csv</con:value></con:property><con:property><con:name>Disposition</con:name><con:value>foobar.csv</con:value></con:property><con:property><con:name>Replace</con:name><con:value>replace</con:value></con:property><con:property><con:name>Activate</con:name><con:value>activate</con:value></con:property><con:property><con:name>VmsuserId</con:name><con:value>DA2627E76B680E75E04400144F48797A</con:value></con:property><con:property><con:name>VmsuserId_user</con:name><con:value>DA2627E76B6A0E75E04400144F48797A</con:value></con:property><con:property><con:name>CustomerId</con:name><con:value>4</con:value></con:property><con:property><con:name>Msisdn</con:name><con:value>008154711</con:value></con:property><con:property><con:name>CorporateId</con:name><con:value>1</con:value></con:property><con:property><con:name>CorporateName</con:name><con:value>secunet Security Networks AG</con:value></con:property><con:property><con:name>SmsOtp</con:name><con:value/></con:property><con:property><con:name>UrlOtp</con:name><con:value/></con:property></con:properties><con:afterLoadScript>import groovy.io.*;
import groovy.swing.SwingBuilder;
import javax.swing.*;
import com.eviware.soapui.support.GroovyUtils.*

def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context)
def projectPath = groovyUtils.projectPath

//determine projectdir by project.getPath, because GroovyUtils.projectpath does not work at startup
path = groovyUtils.projectPath
s= System.getProperty("file.separator");
settingsPath = path+s;
log.info("path = " + path);
//settingsfiles are stored in projecpath\settings
//settingsPath += "settings" + s;

//only works in versions > 4.0 because of SoapUI.isCommandline()
if(com.eviware.soapui.SoapUI.SOAPUI_VERSION.toString().substring(0,1).toInteger() >= 4){
   if(com.eviware.soapui.SoapUI.isCommandLine()){
      setProperties("environment_default", settingsPath);
   }else{
      openDialog();
   }
}

//Method to set project properties
void setProperties(name, location){
   try{
      //read properties file
      FileInputStream fstream = new FileInputStream(location + name + ".properties");
      DataInputStream ins = new DataInputStream(fstream);
      BufferedReader br = new BufferedReader(new InputStreamReader(ins));
      String strLine;

      //set new properties
      while ((strLine = br.readLine()) != null)   {
         attribute = strLine.split("=");
         project.setPropertyValue(attribute[0],attribute[1]);
         project.getPropertyValue(attribute[0]);
      log.info strLine
      }
      ins.close();
   }catch(Exception e){
   	log.info (e.getMessage());
   	log.info "Something went wrong, but properties seems to have been loaded anyway.Errormessage was: "+e 
      //log.info("No project-properties were set, could not find file for name: " + name + " and location: " + location);
   }
}

//Opens the swing dialog
void openDialog(){
	log.info "openDialog"
   def swingBuilder = new SwingBuilder();
   File[] listOfFiles = new File(settingsPath).listFiles();
   int count, count2;
   def options = [];
   def browser = [];
   for (int i = 0; i &lt; listOfFiles.length; i++) {
      if(listOfFiles[i].getName().contains("environment_")){
         name = listOfFiles[i].getName().replace("environment_","").replace(".properties","");
         options[count]=name;
         log.info name
         count++
      }
//      if(listOfFiles[i].getName().contains("browser_")){
//         name = listOfFiles[i].getName().replace("browser_","").replace(".properties","");
//         browser[count2]=name;
//         count2++;
//      }
   }
   def pane = swingBuilder.optionPane(message:'Environment', selectionValues:options, optionType:JOptionPane.CLOSED_OPTION);
   def dialog = pane.createDialog(null, 'Select an environment (' + project.name + ")");
   dialog.show();
   setProperties("environment_" + pane.getInputValue(), settingsPath);
}</con:afterLoadScript><con:wssContainer/><con:databaseConnectionContainer/><con:reporting><con:xmlTemplates/><con:parameters/></con:reporting><con:sensitiveInformation/><con:environment name="OTP"><con:service type="REST" name="/otp/from_url"><con:endpoint domain="" incomingWss="" outgoingWss="" password="" username="" wssTimeToLive="" wssType="">http://${#Project#Host}:${#Project#Port} </con:endpoint></con:service><con:service type="REST" name="/otp/from_url/from_sms"><con:endpoint domain="" incomingWss="" outgoingWss="" password="" username="" wssTimeToLive="" wssType="" proxyHost="" proxyPort="" proxyUsername="" proxyPassword="">http://${#Project#Host}:${#Project#Port} </con:endpoint></con:service><con:property><con:name>Host</con:name><con:value/></con:property><con:property><con:name>Port</con:name><con:value/></con:property><con:property><con:name>MinPINLen</con:name><con:value/></con:property><con:property><con:name>MinPUKLen</con:name><con:value/></con:property><con:property><con:name>PINRetryCnt</con:name><con:value/></con:property><con:property><con:name>PUKRetryCnt</con:name><con:value/></con:property><con:property><con:name>OTPDefaultLen</con:name><con:value/></con:property><con:property><con:name>Bans</con:name><con:value/></con:property><con:property><con:name>Search</con:name><con:value/></con:property><con:property><con:name>Start</con:name><con:value/></con:property><con:property><con:name>Limit</con:name><con:value/></con:property><con:property><con:name>Sort</con:name><con:value/></con:property><con:property><con:name>Direction</con:name><con:value/></con:property><con:property><con:name>Username</con:name><con:value/></con:property><con:property><con:name>Password</con:name><con:value/></con:property><con:property><con:name>Domain</con:name><con:value/></con:property><con:property><con:name>Type</con:name><con:value/></con:property><con:property><con:name>Disposition</con:name><con:value/></con:property><con:property><con:name>Replace</con:name><con:value/></con:property><con:property><con:name>Activate</con:name><con:value/></con:property><con:property><con:name>VmsuserId</con:name><con:value/></con:property><con:property><con:name>VmsuserId_user</con:name><con:value/></con:property><con:property><con:name>CustomerId</con:name><con:value/></con:property><con:property><con:name>Msisdn</con:name><con:value/></con:property><con:property><con:name>CorporateId</con:name><con:value/></con:property><con:property><con:name>CorporateName</con:name><con:value/></con:property><con:property><con:name>SmsOtp</con:name><con:value/></con:property><con:property><con:name>UrlOtp</con:name><con:value/></con:property><con:databaseConnectionContainer/></con:environment></con:soapui-project>